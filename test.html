<html>

<head>
  <title>Ice Cream Picker</title>
  <meta charset="utf-8">
  <script src='https://cdn.plot.ly/plotly-2.20.0.min.js'></script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js'></script>
  <script type="text/javascript" src="https://canvasjs.com/assets/script/jquery-1.11.1.min.js"></script>
  <script type="text/javascript" src="https://cdn.canvasjs.com/canvasjs.stock.min.js"></script>

  <!-- <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
  <script defer src="https://pyscript.net/latest/pyscript.js"></script> -->
</head>

</head>

<body>
  <!-- <py-config>
    packages = ["matplotlib", "pandas", "seaborn", "numpy"]
    [[fetch]]
    files = ['bitstampUSD.csv']
  </py-config>



  <py-script>
    import pandas as pd
    import matplotlib.pyplot as plt
    import seaborn as sns
    from pyodide.http import open_url
    import numpy as np



    df = pd.read_csv('bitstampUSD.csv')
    df1= df.dropna()
    df1.reset_index(inplace =True, drop=True)


    def graph_1(data) :
    plt.rcParams["figure.figsize"] = (22,20)
    fig, ax = plt.subplots()
    ax.plot(data["Timestamp"], data["Weighted_Price"])
    ax.set(xlabel='Timestamp', ylabel='Weighted_Price')
    display(fig, target="graph-area_1", append=False)



    def graph_2(data):
    plt.rcParams["figure.figsize"] = (22,20)
    fig, ax = plt.subplots()
    ax.scatter(data["Volume_(BTC)"], data["Volume_(Currency)"], alpha=0.5)
    display(fig, target="graph-area", append=False)



    graph_1(df1)
    graph_2(df1)


  </py-script> -->



  <div id="graph-area"></div>
  <div id="graph-area_1"></div>
  <div id="candleChar">
    <div>
      candle chart
    </div>
    <div id="simpleCandleChart1"></div>
  </div>
  <div>
    <div>
      bar chart
    </div>
    simple BarChar Open Close
    <div id="simple_BarChar_Open_Close">

    </div>
    simple Bar Char High Low
    <div id="simple_Bar_Char_High_Low">

    </div>
  </div>
  <div>
    simple line volume
    <div id="simple_line_Volume">

    </div>
  </div>
  <script>
    let rowConverter = function (d) {
      let date = []
      let open = []
      let high = []
      let low = []
      let adj_Close = []
      let volume = []
      let close = []

      // Date,Open,High,Low,Close,Adj_Close,Volume  d.length
      for (let i = 0; i < d.length; i++) {
        open.push(Number.parseFloat(d[i].Open))
        high.push(Number.parseFloat(d[i].High))
        low.push(Number.parseFloat(d[i].Low))
        adj_Close.push(Number.parseFloat(d[i].Adj_Close))
        volume.push(Number.parseFloat(d[i].Volume))
        date.push(d[i].Date)
        close.push((Number.parseFloat(d[i].Close)))
      }
      return {
        date,
        open,
        high,
        low,
        adj_Close,
        volume,
        close
      }
    }
    let drawCandleSimple = (idDiv, data, startDate, endDate, typeChart, title) => {
      let trace = {
        x: data.date,
        close: data.close,
        high: data.high,
        low: data.low,
        open: data.open,
        increasing: {
          line: {
            color: 'black'
          }
        },
        decreasing: {
          line: {
            color: 'red'
          }
        },

        //type: 'candlestick',
        type: typeChart,
        xaxis: 'x',
        yaxis: 'y'
      };

      let input = [trace];
      let layout = {
        dragmode: 'zoom',
        showlegend: true,
        xaxis: {
          autorange: true,
          title: title,
          rangeselector: {
            x: 0,
            y: 1.2,
            xanchor: 'left',
            font: {
              size: 8
            },
            buttons: [{
              step: 'month',
              stepmode: 'backward',
              count: 1,
              label: '1 month'
            }, {
              step: 'month',
              stepmode: 'backward',
              count: 6,
              label: '6 months'
            }, {
              step: 'all',
              label: 'All dates'
            }]
          }
        },
        yaxis: {
          autorange: true,
        }
      };
      Plotly.newPlot(idDiv, input, layout);
    }
    let drawCandleStick = (idDiv, data, startDate, endDate, typeChart, title) => {
      let trace = {
        x: data.date,
        close: data.close,
        high: data.high,
        low: data.low,
        open: data.open,
        increasing: {
          line: {
            color: '#17BECF'
          }
        },
        decreasing: {
          line: {
            color: '#7F7F7F'
          }
        },

        line: {
          color: 'rgba(31,119,180,1)'
        },
        //type: 'candlestick',
        type: typeChart,
        xaxis: 'x',
        yaxis: 'y'
      };

      let input = [trace];

      var layout = {
        dragmode: 'zoom',
        margin: {
          r: 10,
          t: 25,
          b: 40,
          l: 60
        },
        showlegend: false,
        xaxis: {
          autorange: true,
          rangeslider: {
            range: [startDate, endDate]
          },
          title: title,
          type: 'date'
        },
        yaxis: {
          autorange: true,
          type: 'linear'
        },

        annotations: [{
          x: startDate,
          y: 0.9,
          xref: 'x',
          yref: 'paper',
          text: 'largest movement',
          font: {
            color: 'magenta'
          },
          showarrow: true,
          xanchor: 'right',
          ax: -20,
          ay: 0
        }],

        shapes: [{
          type: 'rect',
          xref: 'x',
          yref: 'paper',
          x0: startDate,
          y0: 0,
          x1: endDate,
          y1: 1,
          fillcolor: '#d3d3d3',
          opacity: 0.2,
          line: {
            width: 0
          }
        }]
      };
      Plotly.newPlot(idDiv, input, layout);
    }
    let drawBarChart = (row, column1, column2, name1, name2, idDiv) => {
      let trace1 = {
        x: row,
        y: column1,
        name: name1,
        type: "histogram",

      }
      let trace2 = {
        x: row,
        y: column2,
        name: name2,
        type: "histogram",
      }
      var data = [trace1, trace2];
      var layout = {
        barmode: "stack"
      };
      Plotly.newPlot(idDiv, data, layout);

    }
    let drawLine = (x, y, idDiv, title) => {
      let data = {
        type: "scatter",
        mode: "lines",
        name: 'AAPL Low',
        x,
        y
      }
      input = [data]
      var layout = {
        title: 'Time Series with Rangeslider',
        xaxis: {
          autorange: true,
          range: ['2015-02-17', '2017-02-16'],
          rangeselector: {
            buttons: [{
                count: 1,
                label: '1m',
                step: 'month',
                stepmode: 'backward'
              },
              {
                count: 6,
                label: '6m',
                step: 'month',
                stepmode: 'backward'
              },
              {
                step: 'all'
              }
            ]
          },
          rangeslider: {
            range: ['2015-02-17', '2017-02-16']
          },
          type: 'date'
        },
        yaxis: {
          autorange: true,
          range: [86.8700008333, 138.870004167],
          type: 'linear'
        }
      };

      Plotly.newPlot(idDiv, input,layout);

    }
  </script>
  <script>
    d3.csv("BTC-USD.csv", function (raw_data) {
      let data = rowConverter(raw_data)
      drawCandleSimple("simpleCandleChart1", data, "2008-08-08", "2016-07-01", 'candlestick', 'BTC-USD')
    })
    d3.csv("BTC-USD.csv", function (raw_data) {
      let data = rowConverter(raw_data)
      drawBarChart(data.date, data.close, data.open, 'close', 'open', 'simple_BarChar_Open_Close')
    })
    d3.csv("BTC-USD.csv", function (raw_data) {
      let data = rowConverter(raw_data)
      drawBarChart(data.date, data.high, data.low, 'high', 'close', 'simple_Bar_Char_High_Low')
    })
    d3.csv("BTC-USD.csv", function (raw_data) {
      let data = rowConverter(raw_data)
      drawLine(data.date, data.volume, 'simple_line_Volume', 'Volume')
    })
  </script>


</body>

</html>